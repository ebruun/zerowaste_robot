from compas.geometry import Frame
from compas.geometry import Point
from compas.geometry import Vector
from compas.geometry import Transformation

import cv2 as cv
import numpy as np

f1 = Frame(
    Point(1231.0929857258,2419.28094095468,1301.099233685),
    Vector(0.0790099124356339,0.996507820346806,0.0270110667055376),
    Vector(0.679305952325499,-0.0339896636151278,-0.733067613459003),
    )

a1 = [3900]


points = [
[1277.131791,3953.155035,940.653793],
[1375.742792,3514.475392,979.901325],
[1440.527609,3954.701118,1176.376369],
[1519.625107,3638.090953,1215.639565],
[1715.874337,3790.71872,1374.181958],
[1779.676155,3453.208077,1296.687807],
[1798.944493,3097.36609,938.089472],
[1854.570574,3691.998652,1411.031271],
[1896.784457,4035.894972,1424.831695],
[2106.576316,3455.826759,1364.554926],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2179.389675,4036.623757,1445.356768],
[2186.260216,3230.74997,1199.105343],
[2250.385755,3066.1805,964.74048],
[2477.002606,3633.952129,1350.174029],
[2531.156749,3796.81435,1354.694784],
[2531.156749,3796.81435,1354.694784],
[2583.151401,3304.776475,1087.451401],
[2654.716225,3489.063598,1173.399508],
[2761.025812,3796.444606,1182.72571],
[2761.025812,3796.444606,1182.72571],
[2926.458595,3795.553126,948.122028],
[2926.458595,3795.553126,948.122028],
]

x_vectors = [
[-0.001833,-0.999997,0.00132],
[0.352332,-0.881059,-0.315591],
[-0.002348,-0.999992,0.003203],
[0.173751,-0.939944,-0.293796],
[0.045445,-0.984347,-0.17028],
[0,-0.825759,-0.564023],
[0.967909,-0.19894,0.153545],
[0,-0.957127,-0.289668],
[-0.949707,0,-0.313139],
[0.995773,0.026557,-0.087921],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[-0.999991,-0.000026,-0.004333],
[0.983844,0.10077,-0.147977],
[0.968583,0.196526,-0.152399],
[0.043863,0.984494,0.169847],
[-0.001924,0.99998,-0.006009],
[-0.001924,0.99998,-0.006009],
[0.672747,0,-0.739873],
[0.170723,0.940509,0.293763],
[-0.003447,0.999983,-0.004788],
[-0.003447,0.999983,-0.004788],
[-0.003962,0.999988,-0.002905],
[-0.003962,0.999988,-0.002905],
]

y_vectors = [
[-0.584273,0,-0.811557],
[-0.667201,0,-0.744877],
[-0.80646,0,-0.591289],
[-0.860742,0,-0.509042],
[-0.966182,0,-0.257861],
[-0.982882,0.103914,-0.152135],
[0,-0.610995,-0.791634],
[-0.995074,0.028717,-0.094887],
[0.001658,0.999986,-0.005029],
[0,-0.957284,-0.28915],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,0.999981,-0.006101],
[0,-0.826548,-0.562866],
[0,-0.612802,-0.790237],
[0.968234,0,-0.250047],
[0.952385,0,-0.304899],
[0.952385,0,-0.304899],
[-0.348376,-0.882208,-0.316769],
[0.864596,0,-0.502468],
[0.81155,0,-0.584284],
[0.81155,0,-0.584284],
[0.591273,0,-0.806471],
[0.591273,0,-0.806471],
]


def make_frames(p,x,y):
    frames = []
    for p,x,y in zip(points, x_vectors, y_vectors):
        p_cmps = Point(p[0], p[1], p[2])
        x_cmps = Vector(x[0], x[1], x[2])
        y_cmps = Vector(y[0], y[1], y[2])

        frames.append(Frame(p_cmps, x_cmps, y_cmps))
    
    return frames


def make_yaml(i, pose = False):
    filename = "dataset/pos{:02d}.yaml".format(i)
    s = cv.FileStorage(filename, cv.FileStorage_WRITE)

    pose_cart_1 = (pose[0], pose[1], pose[2], pose[3], pose[4], pose[5], pose[6], pose[7], pose[8], pose[9])
    F_base = Frame.from_quaternion(pose_cart_1[3:7])
    F_base.point = pose_cart_1[0:3]
    T = Transformation.from_frame(F_base)

    PoseState = np.array(T)

    s.write('PoseState', PoseState)

    pass


if __name__ == "__main__":
    make_yaml(1)